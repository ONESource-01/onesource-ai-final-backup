ğŸš€ STARTING COMPREHENSIVE BACKEND TESTING FOR ONESOURCE AI SYSTEM
================================================================================
Backend URL: https://ai-response-hub-3.preview.emergentagent.com
API Base: https://ai-response-hub-3.preview.emergentagent.com/api
Auth Token: mock_test_token
================================================================================

ğŸš¨ === TESTING CONVERSATION CONTEXT SYSTEM (CRITICAL) ===
Testing multi-turn conversations with context dependency
Focus: pronouns and contextual references (e.g., 'it', 'this', 'that')

1ï¸âƒ£ ACOUSTIC LAGGING CONTEXT CHAIN
First question: 'Tell me about acoustic lagging' (session: context_test_34aec5d8)
âœ… First response received: 0 chars
âŒ FAIL Context Test 1 - First Question (Acoustic Lagging)
   Details: Response missing acoustic lagging content
Follow-up question: 'When do I need to install it?' (same session)
âœ… Follow-up response received: 0 chars
âŒ FAIL Context Test 1 - Pronoun Understanding ('it')
   Details: System does NOT understand contextual reference 'it'
   Context indicators found:
     - acoustic: âŒ
     - lagging: âŒ
     - previous: âŒ
     - discussed: âŒ
     - mentioned: âŒ

2ï¸âƒ£ SESSION ISOLATION TEST
Session A question: 'Tell me about fire safety requirements' (session: session_a_eecd4b01)
Session B question: 'How do I implement this?' (session: session_b_c660554d)
âœ… PASS Context Test 2 - Session Isolation
   Details: Different sessions properly isolated - no context bleeding

ğŸš¨ === TESTING SCHEMA VALIDATION SYSTEM ===
Testing chat responses comply with v2 schema (title, summary, blocks, meta)
Testing schema guard auto-repair functionality

1ï¸âƒ£ TESTING REGULAR CHAT SCHEMA COMPLIANCE
âœ… Chat response received: 200
   âŒ Required field 'text': missing
   âœ… Required field 'meta': present
   âœ… Optional field 'title': present
   âœ… Optional field 'summary': present
   âœ… Optional field 'blocks': present
   âšª Optional field 'emoji_map': not present
   âšª Optional field 'mentoring_insight': not present
âœ… PASS Schema Test 1 - Meta Field Structure
   Details: Meta field contains required subfields
âŒ FAIL Schema Test 1 - V2 Schema Compliance
   Details: Missing required fields: ['text']

2ï¸âƒ£ TESTING ENHANCED CHAT SCHEMA COMPLIANCE
âœ… Enhanced chat response received: 200
âŒ FAIL Schema Test 2 - Enhanced V2 Schema Compliance
   Details: Enhanced endpoint missing required fields: ['text']
âŒ FAIL Schema Test 2 - Knowledge Integration Fields
   Details: Enhanced response missing knowledge integration metadata

3ï¸âƒ£ TESTING SCHEMA METRICS ENDPOINT
âœ… Schema metrics response received: 200
âŒ FAIL Schema Test 3 - Metrics Endpoint
   Details: Schema metrics missing expected fields: {'timestamp': '2025-08-13T08:13:03.588824', 'schema_validation': {'uptime_seconds': 155.79396057128906, 'responses_validated_total': 37, 'schema_validation_failures': 37, 'schema_repairs_total': 37, 'repair_rate_percent': 100.0, 'repair_types': {'missing_title': 0, 'missing_summary': 0, 'missing_blocks': 0, 'missing_meta': 0, 'invalid_schema': 0}, 'is_repair_rate_acceptable': False}}

ğŸš¨ === TESTING REDIS PERSISTENCE ===
Testing conversation storage, retrieval, and TTL (30-day expiration)
Testing conversation history trimming (16 messages max)

1ï¸âƒ£ TESTING CONVERSATION PERSISTENCE
Sending message 1: 'What are structural requirements?'
   âœ… Message 1 sent successfully
Sending message 2: 'How do I calculate load requirements?'
   âœ… Message 2 sent successfully
Sending message 3: 'What materials should I use?'
   âœ… Message 3 sent successfully
Sending message 4: 'When do I need permits?'
   âœ… Message 4 sent successfully

2ï¸âƒ£ TESTING CONVERSATION HISTORY RETRIEVAL
âœ… History retrieved: 0 sessions found
âŒ FAIL Redis Test 1 - Conversation Persistence
   Details: Test session not found in conversation history

4ï¸âƒ£ TESTING CONVERSATION TRIMMING (16 MESSAGE LIMIT)
   Sent message 1/18
   Sent message 6/18
   Sent message 11/18
   Sent message 16/18
âœ… Trimming test session retrieved: 0 messages
âœ… PASS Redis Test 4 - Message Trimming
   Details: Conversation properly trimmed to 0 messages (â‰¤16)

ğŸš¨ === TESTING KNOWLEDGE INTEGRATION ===
Testing knowledge vault search integration in enhanced chat
Testing personal and community knowledge banks

1ï¸âƒ£ TESTING ENHANCED CHAT KNOWLEDGE INTEGRATION
âœ… Enhanced chat response received: 200
   ğŸ“Š Knowledge used: False
   ğŸ“Š Knowledge sources: 0
âŒ FAIL Knowledge Test 1 - Enhanced Chat Integration
   Details: Enhanced chat did not use knowledge integration
âŒ FAIL Knowledge Test 1 - Content References
   Details: Response lacks knowledge-based content references

2ï¸âƒ£ TESTING KNOWLEDGE SEARCH ENDPOINT
âŒ FAIL Knowledge Test 2 - Search Endpoint
   Details: Failed to access knowledge search: 405

3ï¸âƒ£ TESTING PERSONAL KNOWLEDGE UPLOAD
âœ… PASS Knowledge Test 3 - Personal Upload Endpoint
   Details: Personal knowledge upload endpoint is accessible and validates input

ğŸš¨ === TESTING CORE CHAT ENDPOINTS ===
Testing POST /api/chat/ask (regular chat)
Testing POST /api/chat/ask-enhanced (enhanced with knowledge integration)
Both should work with unified chat service

ğŸ” Testing Fire Safety: 'What are fire safety requirements for high-rise buildings in Australia?'

1ï¸âƒ£ TESTING POST /api/chat/ask
   âœ… Regular chat response: 0 chars
âŒ FAIL Core Chat 1 - Regular Chat (Fire Safety)
   Details: Response lacks relevant content (0/4 terms)
âœ… PASS Core Chat 1 - Response Time (Fire Safety)
   Details: Response received within reasonable time
âŒ FAIL Core Chat 1 - Dual-Layer Format (Fire Safety)
   Details: Response missing dual-layer structure

2ï¸âƒ£ TESTING POST /api/chat/ask-enhanced
   âœ… Enhanced chat response: 0 chars
âŒ FAIL Core Chat 2 - Enhanced Chat (Fire Safety)
   Details: Enhanced response lacks relevant content (0/4 terms)
âŒ FAIL Core Chat 2 - Knowledge Integration (Fire Safety)
   Details: Enhanced chat did not integrate knowledge sources
âœ… PASS Core Chat 2 - Enhanced Content (Fire Safety)
   Details: Enhanced response provides comprehensive content

ğŸ” Testing Acoustic Engineering: 'Tell me about acoustic lagging'

1ï¸âƒ£ TESTING POST /api/chat/ask
   âœ… Regular chat response: 0 chars
âŒ FAIL Core Chat 1 - Regular Chat (Acoustic Engineering)
   Details: Response lacks relevant content (0/4 terms)
âœ… PASS Core Chat 1 - Response Time (Acoustic Engineering)
   Details: Response received within reasonable time
âŒ FAIL Core Chat 1 - Dual-Layer Format (Acoustic Engineering)
   Details: Response missing dual-layer structure

2ï¸âƒ£ TESTING POST /api/chat/ask-enhanced
   âœ… Enhanced chat response: 0 chars
âŒ FAIL Core Chat 2 - Enhanced Chat (Acoustic Engineering)
   Details: Enhanced response lacks relevant content (0/4 terms)
âŒ FAIL Core Chat 2 - Knowledge Integration (Acoustic Engineering)
   Details: Enhanced chat did not integrate knowledge sources
âœ… PASS Core Chat 2 - Enhanced Content (Acoustic Engineering)
   Details: Enhanced response provides comprehensive content

================================================================================
ğŸ¯ COMPREHENSIVE TEST RESULTS SUMMARY
================================================================================
ğŸ“Š Total Tests: 26
âœ… Passed: 8
âŒ Failed: 18
ğŸ“ˆ Success Rate: 30.8%

ğŸ” DETAILED RESULTS BY CATEGORY:
âŒ Conversation Context: 1/3 (33.3%)
   âŒ Context Test 1 - First Question (Acoustic Lagging): Response missing acoustic lagging content
   âŒ Context Test 1 - Pronoun Understanding ('it'): System does NOT understand contextual reference 'it'
âŒ Schema Validation: 1/5 (20.0%)
   âŒ Schema Test 1 - V2 Schema Compliance: Missing required fields: ['text']
   âŒ Schema Test 2 - Enhanced V2 Schema Compliance: Enhanced endpoint missing required fields: ['text']
   âŒ Schema Test 2 - Knowledge Integration Fields: Enhanced response missing knowledge integration metadata
   âŒ Schema Test 3 - Metrics Endpoint: Schema metrics missing expected fields: {'timestamp': '2025-08-13T08:13:03.588824', 'schema_validation': {'uptime_seconds': 155.79396057128906, 'responses_validated_total': 37, 'schema_validation_failures': 37, 'schema_repairs_total': 37, 'repair_rate_percent': 100.0, 'repair_types': {'missing_title': 0, 'missing_summary': 0, 'missing_blocks': 0, 'missing_meta': 0, 'invalid_schema': 0}, 'is_repair_rate_acceptable': False}}
âŒ Redis Persistence: 1/2 (50.0%)
   âŒ Redis Test 1 - Conversation Persistence: Test session not found in conversation history
âŒ Knowledge Integration: 1/4 (25.0%)
   âŒ Knowledge Test 1 - Enhanced Chat Integration: Enhanced chat did not use knowledge integration
   âŒ Knowledge Test 1 - Content References: Response lacks knowledge-based content references
   âŒ Knowledge Test 2 - Search Endpoint: Failed to access knowledge search: 405
âŒ Core Chat Endpoints: 4/12 (33.3%)
   âŒ Core Chat 1 - Regular Chat (Fire Safety): Response lacks relevant content (0/4 terms)
   âŒ Core Chat 1 - Dual-Layer Format (Fire Safety): Response missing dual-layer structure
   âŒ Core Chat 2 - Enhanced Chat (Fire Safety): Enhanced response lacks relevant content (0/4 terms)
   âŒ Core Chat 2 - Knowledge Integration (Fire Safety): Enhanced chat did not integrate knowledge sources
   âŒ Core Chat 1 - Regular Chat (Acoustic Engineering): Response lacks relevant content (0/4 terms)
   âŒ Core Chat 1 - Dual-Layer Format (Acoustic Engineering): Response missing dual-layer structure
   âŒ Core Chat 2 - Enhanced Chat (Acoustic Engineering): Enhanced response lacks relevant content (0/4 terms)
   âŒ Core Chat 2 - Knowledge Integration (Acoustic Engineering): Enhanced chat did not integrate knowledge sources

ğŸ¯ CRITICAL FINDINGS:
âŒ CONVERSATION CONTEXT SYSTEM: Issues detected - context not properly maintained
âŒ SCHEMA VALIDATION SYSTEM: Issues detected - schema compliance problems
âŒ REDIS PERSISTENCE: Issues detected - persistence problems

ğŸš€ TESTING COMPLETED
